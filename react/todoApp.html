<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Todo App</title>
	<style>
		table.todo-list{
			border-collapse: collapse;
			width: 380px;
		}
		table.todo-list th,table.todo-list td{
			border:solid 1px gray;
			text-align: center;
		}
		td.finished{
			text-decoration: line-through;
		}
	</style>
</head>
<body>
	<div id="app"></div>

	<script src="react/react.js"></script>
	<script src="react/react-dom.js"></script>
	<script src="babel/browser.js"></script>
	<script type="text/babel">
	
	var data = [
		{title:"学习ES6新语法", finished:false},
		{title:"学习Spring Boot", finished:false},
		{title:"背诵单词", finished:true}
	];

	var TodoHeader = React.createClass({
		addNewTodo:function(){
			if(!this.refs.newTitle.value)
				return;
			this.props.onNewTodoAdd({
				title:this.refs.newTitle.value,
				finished:false
			});
			this.refs.newTitle.value="";
		},
		render:function(){
			return	(
				<div>
					待办事务：
					<input ref="newTitle" />
					<button onClick={this.addNewTodo}>添加</button>
				</div>
			);
		}
	});
	
	var TodoList = React.createClass({
		todoRemove:function(item){
			this.props.onTodoRemove(item);
		},
		todoStatusChange:function(item){
			item.finished = !item.finished;
			this.props.onTodoStatusChange(item);
		},
		render:function(){
			var compo = this;
			return (
				<table className="todo-list">
					<thead><tr><th>完成</th><th>待办事项</th><th>删除</th></tr></thead>
					<tbody>
					{this.props.todos.map(function(item,index){
						return (
						<tr key={index}>
							<td><input type="checkbox" checked={item.finished} onChange={()=>compo.todoStatusChange(item)} /></td>
							<td className={item.finished?'finished':''}>{item.title}</td>
							<td><button onClick={()=>compo.todoRemove(item)}>删除</button></td>
						</tr>
						)
					})}
					</tbody>	
				</table>
			);
		}
	});

	var App = React.createClass({

		addTodo:function(newItem){
			var arr = this.state.todos.slice();
			arr.push(newItem);
			this.setState({
				todos:arr
			});
		},
		removeTodo:function(item){
			var arr = this.state.todos.slice();
			var index = arr.findIndex(function(value,index,arr){
				return value.title===item.title;
			});
			arr.splice(index,1);
			this.setState({
				todos:arr
			});
		},

		changeTodoStatus:function(updateItem){
			var arr = this.state.todos.slice();
			var item = arr.find(function(value,index,arr){
				return updateItem.title === value.title;
			});
			item.finished = updateItem.finished;
			this.setState({
				todos:arr
			});
		},

		getInitialState:function(){
			return {
				todos:data
			}
		},
		render:function(){
			return (
				<div>
					<h3>Todo App</h3>
					<TodoHeader onNewTodoAdd={this.addTodo}></TodoHeader>
					<hr/>
					<TodoList onTodoStatusChange={this.changeTodoStatus} 
					onTodoRemove={this.removeTodo} todos={this.state.todos}></TodoList>
				</div>
			);
		}
	});

	ReactDOM.render(
		<App></App>,
		document.getElementById("app")
	);

	</script>
</body>
</html>